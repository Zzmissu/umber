%# -*- mmm-classes: mason -*- 

<table border="2" bgcolor="#fffff0"><tr><td>
<h3>Debug</h3>
%# % unless ( $ENV{REMOTE_ADDR} =~ /^10\./ ) {
%#  On campus access to this page only.
%# % } else {
<p />
<b>-- %ARGS --</b><br />
%   if (not %ARGS){
&nbsp; Empty.
%   } else {
%     foreach my $key (sort keys %ARGS){
&nbsp; ARGS{<% $key %>} = <% describe($ARGS{$key}) %><br />
%     }
%   }

%# % if ( $ARGS{username} and $ARGS{password} ){
%#   MarlboroLDAP::authenticate(username,password) =
%#   '<% MarlboroLDAP::authenticate($ARGS{username}, $ARGS{password}) %>'
%# % }

<p />
<b>-- component stack --</b><br />
%   foreach my $component ($m->callers){
&nbsp; <% $component->title %> <br />
%   }
<p />
<b>-- session  --</b><br />
<pre>
 session_id is '<% $session->session_id %>'
%# <pre> &nbsp; $session = <% describe($session) %></pre>
%# &nbsp; ref($sesssion) is '<% ref($session) %>' 
%# in current package '<% __PACKAGE__ %>'.<br />
 keys :  <% scalar($session->keys) == 0 ? 'none' : ''  %>
%   foreach my $key ($session->keys){
   <% $key %> is <% describe( $session->get($key) ) %>
%   }

% if (1){
 $session->user is '<% $session->user %>'
 $session->user->username is '<% $session->user->username %>'
% }
</pre>

<p />
<b>-- app --</b><br />
<pre>
 $app = <% describe($app) %>
 $app->args = <% describe($app->args) %>

<p />
<b>-- page --</b><br />
 $page is '<% $page %>'
% for my $keyword (qw(filename short_filename name role_rank document_root
%                     course_directory course_dir directory dir uri 
%                     student_owner title  file_exists extension
%                     lastmodified )){
 $page-><% $keyword %> is '<% $page->$keyword  %>'
% }
 $page->can_read ? <% yes_no( $page->can_read ) %>
 $page->can_write ? <% yes_no( $page->can_write ) %>

 $page->course is '<% describe($page->course) %>'
 $page->course->name is '<% $page->course->name %>'
 $page->course->title is '<% $page->course->title %>'
 $page->course->name_as_title is '<% $page->course->name_as_title %>'
 $page->course->directory is '<% $page->course->directory %>'
 $page->course->uri is '<% $page->course->uri %>'

 $page->attachments_exist ? <% yes_no( $page->atttachments_exist ) %>
 $page->show_attachments  ? <% yes_no( $page->show_attachments ) %>
 $page->is_special  ? <% yes_no( $page->is_special ) %>

 $page->role is '<% $page->role %>'
 $page->role->name is '<% $page->role->name %>'
 $page->role->rank is '<% $page->role->rank %>'
% for my $type (qw( anonymous guest student faculty admin)){
 role >= <% $type %> ? <% yes_no( $page->role->rank >= Role->$type->rank ) %>
% }

 $page->revisions is ( <% join(',', $page->revisions) %> )
 $page->revision_summary is ( <% join(',', $page->revision_summary) %> )
% if ($ARGS{revision}){
 $page->revision_summary( <% $ARGS{revision} %> ) is ( <% 
  join(',', $page->revision_summary( $ARGS{revision} )) %> )
% }

 $page->is_work is <% yes_no( $page->is_work ) %>
 $page->submit_modify is <% yes_no( $page->is_modified ) %>
 $page->work is <% $page->work %>
% if ($page->work){
        work->submitted is <% $page->work->submitted %>
% }

</pre>

<p />
<b>-- apache request --</b><br />
<pre>
 $r = <% describe($r) %>
 - - - - - - 
 $r->protocol = <% describe($r->protocol) %>
 $r->hostname = <% describe($r->hostname) %>
 $r->uri = <% describe($r->uri) %>
 $r->args = <% describe($r->args) %>
 - - - - - - 
 $r->content_type = <% describe($r->content_type) %>
 $r->filename = <% describe($r->filename) %>
 $r->path_info = <% describe($r->path_info) %>
 $r->document_root = <% describe($r->document_root) %>
 $r->server->uid = <% describe($r->server->uid) %>
 $r->server->gid = <% describe($r->server->gid) %>

</pre>

% if (0){
%# !!! Warning: $m contains lots of stuff; display is pretty long.
<p />
<b>-- mason request --</b><br />
<pre>
 $m = <% describe($m) %>
</pre>
% }

<p />
<b>-- ENV --</b><br />
%   foreach my $key (sort keys %ENV){
&nbsp; ENV{<% $key %>} = '<% $ENV{$key} %>' <br />
%   }
<p />
<b>-- other --</b><p />

&nbsp; __PACKAGE__ = '<% __PACKAGE__ %>'<p/>

&nbsp; $r->uri = '<% $r->uri %>'<br />
&nbsp; $r->the_request = '<% $r->the_request %>'<br />
&nbsp; $r->hostname = '<% $r->hostname %>'<br />
&nbsp; $r->get_server_port = '<% $r->get_server_port %>'<br />
<p />
&nbsp; $m->request_comp->name = '<% $m->request_comp->name %>' <br />
&nbsp; $m->request_comp->path = '<% $m->request_comp->path %>' <br />
&nbsp; $m->request_comp->dir_path = '<% $m->request_comp->dir_path %>'<br />
&nbsp; $m->request_comp->source_dir  = '<% $m->request_comp->source_dir   %>'<br />
&nbsp; $m->request_comp->source_file = '<% $m->request_comp->source_file  %>'<br />
<p />
&nbsp; $m->base_comp->path = '<% $m->base_comp->path %>'<br />
&nbsp; $m->current_comp->path = '<% $m->current_comp->path %>'<br />
<p />

% my ($dev,$ino,$mode,$nlink,$uid,$gid,
%     $rdev,$size, $atime,$mtime,$ctime,
%     $blksize,$blocks) = stat($r->filename);
&nbsp; file (mode uid gid) =  (<% sprintf("%o %d %d",$mode, $uid, $gid) %>)
<br/>
&nbsp; apache user = '<% `whoami` %>'
<p/>

%# %}  # end "unless on campus" 
</td></tr></table>

%# =====================================================================
<%init>
 sub yes_no {
   my $boolean = shift;
   return $boolean ? 'yes' : 'no';
 }
</%init>
<%doc>
 $Id: debug.mhtml 1694 2006-03-22 15:57:00Z mahoney $

 Output various diagnostics within another mason component
 by invoking this one with 
 <& $ENV{WA_SRC} . '/scripts/debug.mhtml', %ARGS &>
</%doc>
